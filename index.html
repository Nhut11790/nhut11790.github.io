<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>ƒê√†n Piano 72 ph√≠m (Ghi √¢m)</title>
  <style>
    body { font-family: Arial, sans-serif; background: linear-gradient(135deg,#667eea 0%,#764ba2 100%); margin:0; padding:0; min-height:100vh; }
    .container { width:100%; max-width:1600px; margin:auto; position:relative; padding:28px 0 14px;}
    h1 { color: #FFD700; text-align: center; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); margin: 0 0 10px 0;}
    .sound-control { position: absolute; top: 10px; right: 14px; display: flex; flex-direction: column; align-items: center; z-index: 100; }
    .sound-toggle { background: linear-gradient(145deg, #2ac7ec, #1594bb); color: white; border: none;
      border-radius: 50%; width: 36px; height: 36px; font-size: 19px; cursor: pointer; box-shadow: 0 4px 8px rgba(0,0,0,0.22);
      transition: all 0.2s; display: flex; align-items: center; justify-content: center;}
    .sound-toggle.muted { background: linear-gradient(145deg, #f44336, #d32f2f);}
    .sound-toggle:active { transform: scale(0.96); }
    .sound-status { color: white; font-size: 12px; font-weight: bold; margin-top: 2px; text-shadow: 0 1px 3px rgba(0,0,0,0.14); }
    .record-controls {
      margin: 5px auto 8px auto; display: flex; justify-content: center; gap: 10px; align-items: center;
    }
    .rec-btn, .play-btn, .download-btn, .clear-btn {
      background: linear-gradient(137deg,#2ac7ec,#1594bb); color: #fff; border: none; border-radius: 8px; padding: 5px 10px;
      font-size: 14px; font-weight: bold; box-shadow: 0 2px 8px rgba(0,0,0,0.11);
      cursor: pointer; transition: all 0.13s;
      display: flex; align-items: center; gap:3px; min-width: 72px; min-height: 28px; opacity:1;
    }
    .rec-btn.active { background: linear-gradient(137deg,#FFD700,#ffeb90); color:#1e7e99;}
    .play-btn.active { background: linear-gradient(137deg,#43a047,#2ac7ec); color:#fff;}
    .rec-btn:active,.play-btn:active,.download-btn:active,.clear-btn:active { transform: scale(0.97);}
    .clear-btn { background: linear-gradient(125deg,#2ac7ec,#a81be6); color:#fff;}
    .download-btn { background: linear-gradient(137deg,#2ac7ec,#7B1FA2); color:#fff;}
    .play-btn[disabled], .download-btn[disabled], .clear-btn[disabled]{ opacity: 0.49; cursor: not-allowed; }
    .record-status { font-size:14px;font-weight: bold; color:#fff;margin-left:10px; text-shadow:0 2px 7px rgba(22,96,215,0.13);}
    .record-status.active { color: #FFD700;}
    .play-remaining { margin-left:8px; font-size:13px; color:#90eeff; font-weight:bold;}
    .loading-status { text-align: center; color: #FFD700; font-size: 13px; margin: 7px 0 10px 0; font-weight: bold; }
    #alert { text-align: center; color: #f44336; background: #fff2f2; border-radius: 7px; font-size: 14px; font-weight:bold;
      margin: 11px auto 0 auto; max-width: 320px; padding: 8px 11px; display: none; box-shadow: 0 2px 10px rgba(0,0,0,0.08); border: 1px solid #ffd9d9;
    }
    .piano-container { background: rgba(0,0,0,0.27); backdrop-filter: blur(8px); border-radius: 10px; padding: 10px; box-shadow: 0 9px 28px rgba(0,0,0,0.39); max-width: 1540px; margin: auto; }
    .piano { position: relative; height: 180px; width: 2376px; margin: 0 auto;}
    .white-key { position: absolute; width: 33px; height: 180px; background: linear-gradient(to bottom, #fff 0%, #ececec 100%);
      border: 2px solid #222; border-radius: 0 0 6px 6px; cursor: pointer; user-select: none;
      display: flex; align-items: flex-end; justify-content: center; padding-bottom: 4px; font-size: 9px; color: #555; font-weight: bold; transition: all 0.06s;}
    .white-key.active { background: linear-gradient(137deg, #2ac7ec 0%, #76e2ff 100%); color: #1d8a95;}
    .white-key:active { background: linear-gradient(137deg, #b3e5fc 0%, #2ac7ec 100%);}
    .black-key { position: absolute; width: 22px; height: 110px; background: linear-gradient(to bottom, #444 0%, #091a21 100%);
      border: 1px solid #111; border-radius: 0 0 4px 4px; cursor: pointer; user-select: none; z-index: 9; color: white;
      display: flex; align-items: flex-end; justify-content: center; padding-bottom: 3px; font-size: 7px; font-weight: bold;
      box-shadow: 0 2px 4px rgba(0,0,0,0.52); transition: all 0.05s;}
    .black-key.active { background: linear-gradient(137deg, #2ac7ec 0%, #76e2ff 100%); color: #1d8a95;}
    .black-key:active { background: linear-gradient(137deg, #b3e5fc 0%, #2ac7ec 100%);}
    .created-by-footer { text-align: center; color: #fff; font-size: 15px; opacity: 0.91; margin: 28px auto 14px auto; width: 100%; }
    @media (max-width: 2400px){
      .piano { width:2392px; max-width:98vw;}
      .piano-container{max-width:99vw;}
    }
    @media (max-width: 1900px){
      .piano { width:1910px;}
    }
    @media (max-width: 1290px){
      .piano { width:98vw; max-width:1260px;}
    }
    @media (max-width: 900px){
      .piano-container{max-width:99vw;}
      .piano{width:930px;}
    }
    @media (max-width: 1000px){
      .container{padding:13px 0;}
    }
    @media (max-width: 700px){
      .piano{width:650px;}
      .piano-container{padding:3px;}
    }
    @media (max-width: 650px){
      .piano{width:99vw;}
      .container{padding:6px 0;}
      .piano-container{padding:1px;}
    }
    /* Thanh cu·ªôn ngang piano */
    .scroll-piano {
      overflow-x: auto;
      overflow-y: visible;
      max-width: 100%;
      max-height: 210px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="sound-control">
      <button class="sound-toggle muted" id="soundToggle">
        <span id="soundIcon">üîá</span>
      </button>
      <span class="sound-status" id="soundStatus">T·∫Øt √¢m</span>
    </div>
    <h1>üéπ ƒê√†n Piano 72 ph√≠m</h1>
    <div class="record-controls">
      <button class="rec-btn" id="recordBtn"><span id="recIcon">‚è∫Ô∏è</span> Ghi √¢m</button>
      <button class="play-btn" id="playBtn" disabled><span id="playIcon">‚ñ∂Ô∏è</span> Ph√°t l·∫°i</button>
      <button class="download-btn" id="downloadBtn" disabled><span id="downIcon">üíæ</span> T·∫£i v·ªÅ</button>
      <button class="clear-btn" id="clearBtn" disabled><span id="clearIcon">üóëÔ∏è</span> X√≥a</button>
      <span class="record-status" id="recordStatus">Ch∆∞a ghi √¢m</span>
      <span class="play-remaining" id="playRemaining"></span>
    </div>
    <div class="loading-status" id="loadingStatus">‚è≥ ƒêang t·∫£i Piano...</div>
    <div id="alert"></div>
    <div class="piano-container scroll-piano">
      <div class="piano" id="piano"></div>
    </div>
  </div>
  <div class="created-by-footer">Created by Minh Nh·ª±t</div>
  <script>
    // C√°c note piano t·ª´ A0 ƒë·∫øn C8 (72 ph√≠m)
    const piano72Notes = (() => {
      const notes = [];
      const keyNames = ['A','A#','B','C','C#','D','D#','E','F','F#','G','G#'];
      let octStart = 0, octEnd = 8;
      for (let o = octStart; o <= octEnd; o++) {
        for (let k=0; k<keyNames.length; k++) {
          // B·ªè c√°c ph√≠m kh√¥ng t·ªìn t·∫°i ·ªü octave 0 v√† 8, gi·ªØ 72 ph√≠m h·ª£p chu·∫©n
          if ((o === 0 && ['A','A#','B'].indexOf(keyNames[k])===-1) || 
              (o === 8 && keyNames[k] !== 'C')) continue;
          notes.push(keyNames[k]+o);
        }
      }
      return notes.slice(0,72);
    })();
    // T√≠nh t·∫ßn s·ªë c√°c ph√≠m piano
    const notesFreq = (() => {
      const freq = {};
      const keyOrder = ['C','C#','D','D#','E','F','F#','G','G#','A','A#','B'];
      for (let n = 0; n < piano72Notes.length; n++) {
        const note = piano72Notes[n];
        let m = note.match(/^([A-G]#?)(\d)$/);
        let k = keyOrder.indexOf(m[1]), o = parseInt(m[2]);
        let midi = k + 12*(o+1);
        freq[note] = 440 * Math.pow(2,(midi-69)/12);
      }
      return freq;
    })();
    // Ch·ªâ c√≥ ti·∫øng Piano th·∫≠t
    const sampleInstrument = {
      name: 'üéπ Acoustic Grand Piano',
      folder: 'acoustic_grand_piano-mp3'
    };
    const sampleBaseURL = "https://raw.githubusercontent.com/Nhut11790/nhut11790.github.io/main/tieng/";
    let audioContext = null;
    let isMuted = true, isAudioActivated = false;
    let sampleBuffers = {}; // l∆∞u t·ª´ng note piano
    let hasPreload = false;

    // Ghi √¢m
    let isRecording = false;
    let recordStart = 0;
    let noteRecords = [];
    let playbackTimeouts = [];
    let isPlayingBack = false;
    let playbackStartTime = 0;
    let playbackEndTime = 0;
    let playbackTimer = null;

    function initAudioContext() {
      if (!audioContext) { audioContext = new (window.AudioContext || window.webkitAudioContext)(); }
      if (audioContext.state === 'suspended') audioContext.resume();
    }
    // ƒê·ªïi note # sang t√™n b√≠nh √¢m chu·∫©n cho file
    function convertSharpToFlat(note) {
      const sharpToFlat = { 'C#': 'Db', 'D#': 'Eb', 'F#': 'Gb', 'G#': 'Ab', 'A#': 'Bb' };
      for (let sharp in sharpToFlat) {
        if (note.startsWith(sharp))
          return note.replace(sharp, sharpToFlat[sharp]);
      }
      return note;
    }
    async function preloadSamples() {
      let notesList = piano72Notes;
      let folder = sampleInstrument.folder;
      let successCount = 0;
      document.getElementById('loadingStatus').textContent = `‚è≥ ƒêang t·∫£i Piano...`;
      let promises = notesList.map(note => {
        let flatNote = convertSharpToFlat(note);
        let fileName = flatNote + '.mp3';
        let url = `${sampleBaseURL}${folder}/${fileName}`;
        return fetch(url)
          .then(res => res.ok ? res.arrayBuffer() : null)
          .then(buf => buf ? audioContext.decodeAudioData(buf) : null)
          .then(audioBuf => { 
            if(audioBuf) {
              sampleBuffers[note] = audioBuf; successCount++;
              document.getElementById('loadingStatus').textContent = `‚è≥ ƒêang t·∫£i Piano... (${successCount}/${notesList.length})`;
            }
          }).catch(()=>{});
      });
      await Promise.all(promises);
      if (successCount === 0) {
        document.getElementById('loadingStatus').textContent = `‚ùå Kh√¥ng th·ªÉ t·∫£i piano`;
      } else {
        document.getElementById('loadingStatus').textContent = `‚úÖ ƒê√£ t·∫£i Piano`;
        setTimeout(() => { document.getElementById('loadingStatus').style.display = 'none'; },1300);
      }
      hasPreload = true;
    }
    async function ensureSamples() {
      initAudioContext();
      if (!hasPreload) {
        document.getElementById('loadingStatus').style.display = 'block';
        await preloadSamples();
      }
    }
    function showAlert(msg) {
      const alertBox = document.getElementById("alert");
      alertBox.textContent = msg;
      alertBox.style.display = "block";
      setTimeout(() => { alertBox.style.display = "none"; }, 2100);
    }

    // ==== Render Piano 72 ph√≠m
    function renderPiano() {
      const pianoDiv = document.getElementById('piano');
      pianoDiv.innerHTML = '';
      const whiteOrder = ['C','D','E','F','G','A','B'];
      const blackMap = {
        'C': 'C#','D': 'D#','F': 'F#','G': 'G#','A': 'A#'
      };
      let whites = [], whitesIndex = {};
      piano72Notes.forEach(note => {
        let m = note.match(/^([A-G])([#]?)(\d)$/);
        if (m && !m[2]) { whitesIndex[note]=whites.length; whites.push({note: note, octave: m[3], key: m[1]}); }
      });
      // Tr·∫Øng
      whites.forEach((data, i) => {
        let left = i * 33;
        const key = document.createElement('div');
        key.className = 'white-key';
        key.dataset.note = data.note;
        key.textContent = data.note;
        key.style.left = left + 'px';
        key.id = 'key_'+data.note;
        key.tabIndex = 0;
        key.addEventListener('mousedown', () => { key.classList.add('active'); playKeyNote(data.note,key); });
        key.addEventListener('touchstart', (e) => { e.preventDefault(); key.classList.add('active'); playKeyNote(data.note,key); });
        key.addEventListener('mouseup', () => { key.classList.remove('active'); });
        key.addEventListener('mouseleave', () => { key.classList.remove('active'); });
        key.addEventListener('touchend', () => { key.classList.remove('active'); });
        pianoDiv.appendChild(key);
      });
      // ƒêen
      whites.forEach((data, i) => {
        let bKey = blackMap[data.key];
        if (!bKey) return;
        let blackNote = bKey + data.octave;
        if (!piano72Notes.includes(blackNote)) return;
        let left = (i * 33) + 22;
        const key = document.createElement('div');
        key.className = 'black-key';
        key.dataset.note = blackNote;
        key.textContent = blackNote;
        key.style.left = left + 'px';
        key.id = 'key_' + blackNote;
        key.tabIndex = 0;
        key.addEventListener('mousedown', () => { key.classList.add('active'); playKeyNote(blackNote,key); });
        key.addEventListener('touchstart', (e) => { e.preventDefault(); key.classList.add('active'); playKeyNote(blackNote,key); });
        key.addEventListener('mouseup', () => { key.classList.remove('active'); });
        key.addEventListener('mouseleave', () => { key.classList.remove('active'); });
        key.addEventListener('touchend', () => { key.classList.remove('active'); });
        pianoDiv.appendChild(key);
      });
    }
    async function playSample(note, volume=1.0, duration=1200) {
      if (!audioContext || isMuted || !isAudioActivated) return;
      let sampleBuffer = sampleBuffers[note];
      let rootNote = note;
      if (!sampleBuffer) {
        const availableNotes = Object.keys(sampleBuffers).filter(n => sampleBuffers[n]);
        let minDiff = Infinity, bestNote=null;
        for(const avail of availableNotes){
          let diff = Math.abs(notesFreq[avail] - notesFreq[note]);
          if(diff < minDiff){minDiff=diff;bestNote=avail;}
        }
        if (!bestNote) return;
        sampleBuffer = sampleBuffers[bestNote];
        rootNote = bestNote;
      }
      const src = audioContext.createBufferSource();
      src.buffer = sampleBuffer;
      let semitone = Math.log2(notesFreq[note] / notesFreq[rootNote]) * 12;
      src.playbackRate.value = Math.pow(2,semitone/12);
      const gainNode = audioContext.createGain();
      gainNode.gain.value = volume;
      gainNode.connect(audioContext.destination);
      src.connect(gainNode);
      src.start();
      src.stop(audioContext.currentTime + Math.min(duration/1000,src.buffer.duration/src.playbackRate.value));
    }
    // Khi nh·∫•n ph√≠m
    async function playKeyNote(note,keyElement) {
      if (isPlayingBack) return;
      if (!isAudioActivated) { showAlert("B·∫≠t √¢m b·∫±ng n√∫t üîá tr∆∞·ªõc khi ch∆°i!"); return; }
      initAudioContext();
      if (keyElement) {
        keyElement.classList.add('active');
        setTimeout(() => { keyElement.classList.remove('active'); }, 200);
      }
      await ensureSamples();
      playSample(note,1.0,1110);
      // Ghi v√†o record n·∫øu ƒëang ghi √¢m
      if (isRecording) {
        let now = Date.now();
        if (noteRecords.length === 0) recordStart = now;
        noteRecords.push({
          note: note, ts: now - recordStart
        });
        updateRecordStatus();
      }
    }
    // Ph√°t l·∫°i
    async function playback() {
      if (noteRecords.length === 0) return;
      isPlayingBack = true;
      setPlaybackUI(true);
      playbackStartTime = Date.now();
      playbackEndTime = playbackStartTime + (noteRecords[noteRecords.length-1].ts || 0);
      showPlaybackRemaining();
      for (let i = 0; i < noteRecords.length; i++) {
        let rec = noteRecords[i];
        let t = setTimeout(async () => {
          await ensureSamples();
          let keyEl = document.getElementById('key_' + rec.note);
          if (keyEl) {
            keyEl.classList.add('active');
            setTimeout(() => { keyEl.classList.remove('active'); }, 200);
          }
          playSample(rec.note);
          if (i === noteRecords.length - 1) {
            setTimeout(() => { isPlayingBack = false; setPlaybackUI(false); hidePlaybackRemaining(); },500);
          }
        }, rec.ts);
        playbackTimeouts.push(t);
      }
    }
    function showPlaybackRemaining() {
      hidePlaybackRemaining();
      if (noteRecords.length < 1) return;
      let playRem = document.getElementById('playRemaining');
      playRem.style.display = 'inline';
      const totalMs = noteRecords[noteRecords.length-1].ts;
      function updateTimer() {
        if (!isPlayingBack) { playRem.textContent = ""; return;}
        let now = Date.now();
        let remaining = Math.max(0, Math.round((playbackEndTime-now)/1000));
        playRem.textContent = "‚è± "+remaining+" gi√¢y";
        if (remaining <= 0) playRem.textContent="";
      }
      updateTimer();
      playbackTimer = setInterval(updateTimer, 560);
    }
    function hidePlaybackRemaining() {
      let playRem = document.getElementById('playRemaining');
      playRem.textContent = "";
      if (playbackTimer) clearInterval(playbackTimer);
      playbackTimer = null;
    }
    function stopPlayback() {
      playbackTimeouts.forEach(tid => clearTimeout(tid));
      playbackTimeouts = [];
      isPlayingBack = false;
      setPlaybackUI(false);
      hidePlaybackRemaining();
    }
    function setRecordUI(active) {
      recordBtn.classList.toggle('active', active);
      recordBtn.innerHTML = active ? '<span id="recIcon">‚èπÔ∏è</span> D·ª´ng ghi √¢m' : '<span id="recIcon">‚è∫Ô∏è</span> Ghi √¢m';
      recordStatus.classList.toggle('active', active);
      recordStatus.textContent = active ? "ƒêang ghi √¢m..." : noteRecords.length>0 ? `ƒê√£ ghi ${noteRecords.length} n·ªët` : "Ch∆∞a ghi √¢m";
      playBtn.disabled = noteRecords.length===0 || active;
      downloadBtn.disabled = noteRecords.length===0 || active;
      clearBtn.disabled = noteRecords.length===0 || active;
    }
    function setPlaybackUI(active) {
      playBtn.classList.toggle('active', active);
      playBtn.innerHTML = active ? '<span id="playIcon">‚èπÔ∏è</span> D·ª´ng l·∫°i' : '<span id="playIcon">‚ñ∂Ô∏è</span> Ph√°t l·∫°i';
      recordBtn.disabled = active;
      downloadBtn.disabled = noteRecords.length===0 || active;
      clearBtn.disabled = noteRecords.length===0 || active;
      recordStatus.textContent = active ? "ƒêang ph√°t l·∫°i..." : noteRecords.length>0 ? `ƒê√£ ghi ${noteRecords.length} n·ªët` : "Ch∆∞a ghi √¢m";
      playBtn.disabled = noteRecords.length===0;
    }
    function updateRecordStatus() {
      let status='Ch∆∞a ghi √¢m';
      if (isRecording) status = 'ƒêang ghi √¢m...';
      else if (noteRecords.length>0) status = `ƒê√£ ghi ${noteRecords.length} n·ªët`;
      recordStatus.textContent=status;
      playBtn.disabled = noteRecords.length===0 || isRecording;
      downloadBtn.disabled = noteRecords.length===0 || isRecording;
      clearBtn.disabled = noteRecords.length===0 || isRecording;
    }
    function downloadRecord() {
      if (noteRecords.length===0) return;
      let obj = {
        instrument: 'piano',
        notes: noteRecords,
        date: new Date().toISOString(),
        info: "File Piano 72 ghi l·∫°i b·∫£n ch∆°i, s·ª≠ d·ª•ng tr√™n web n√†y."
      };
      let url = URL.createObjectURL(new Blob([JSON.stringify(obj,null,2)],{type:"application/json"}));
      let a = document.createElement('a');
      a.href=url;
      a.download="ban-ghi-piano72-"+Date.now()+".json";
      document.body.appendChild(a); a.click(); document.body.removeChild(a);
      setTimeout(()=>{URL.revokeObjectURL(url)},1300);
    }
    function clearRecord(){
      if (isRecording) return;
      noteRecords = [];
      updateRecordStatus();
      hidePlaybackRemaining();
    }
    // N√∫t ch·ª©c nƒÉng
    const recordBtn = document.getElementById('recordBtn');
    const playBtn = document.getElementById('playBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const recordStatus = document.getElementById('recordStatus');
    const clearBtn = document.getElementById('clearBtn');
    playBtn.disabled = true; downloadBtn.disabled = true; clearBtn.disabled = true;
    recordBtn.addEventListener('click', ()=>{
      if (isPlayingBack) return;
      if (!isRecording) {
        isRecording=true; noteRecords=[];
        recordStart=0; setRecordUI(true); hidePlaybackRemaining();
      } else {
        isRecording=false; setRecordUI(false);
      }
    });
    playBtn.addEventListener('click', ()=>{
      if (isPlayingBack) { stopPlayback(); return; }
      if (noteRecords.length>0) playback();
    });
    downloadBtn.addEventListener('click', downloadRecord);
    clearBtn.addEventListener('click', ()=>{clearRecord();});
    // √Çm thanh: b·∫≠t/t·∫Øt
    const soundToggle = document.getElementById('soundToggle');
    const soundIcon = document.getElementById('soundIcon');
    const soundStatus = document.getElementById('soundStatus');
    soundToggle.addEventListener('click', async () => {
      if (!isAudioActivated) {
        soundToggle.disabled = true;
        soundIcon.textContent = '‚è≥';
        soundStatus.textContent = 'ƒêang k√≠ch ho·∫°t...';
        try {
          initAudioContext();
          const testAudio = new Audio('https://raw.githubusercontent.com/nhut990/files/refs/heads/main/tieng/E3_active_audio.mp3');
          testAudio.volume = 0.3;
          await new Promise((resolve,reject)=>{
            testAudio.addEventListener('canplaythrough',()=>{
              testAudio.play().then(()=>{
                setTimeout(()=>{
                  testAudio.pause();
                  testAudio.currentTime=0;resolve();
                },250);
              }).catch(reject);
            },{once:true});
            testAudio.addEventListener('error',reject,{once:true});
            testAudio.load();
            setTimeout(()=>reject(new Error('Timeout')),4000);
          });
          await audioContext.resume();
          isAudioActivated = true; isMuted = false;
          soundToggle.classList.remove('muted');
          soundToggle.style.opacity = '1';
          soundToggle.style.cursor = 'pointer';
          soundIcon.textContent = 'üîä';
          soundStatus.textContent = '√Çm thanh b·∫≠t';
          soundToggle.disabled = false;
        } catch (error) {
          soundToggle.disabled = false;
          soundIcon.textContent = 'üîá';
          soundStatus.textContent = 'Th·ª≠ l·∫°i';
          alert('‚ö†Ô∏è Kh√¥ng th·ªÉ k√≠ch ho·∫°t √¢m thanh.\n\nL·ªói: ' + error.message);
        }
      } else {
        isMuted = !isMuted;
        if (isMuted) {
          soundToggle.classList.add('muted');
          soundIcon.textContent = 'üîá';
          soundStatus.textContent = 'T·∫Øt √¢m';
        } else {
          soundToggle.classList.remove('muted');
          soundIcon.textContent = 'üîä';
          soundStatus.textContent = '√Çm thanh b·∫≠t';
        }
      }
    });
    // T·∫£i piano v√† render 1 l·∫ßn khi load trang
    window.addEventListener('load', async () => {
      initAudioContext();
      await ensureSamples();
      renderPiano();
      document.getElementById('loadingStatus').style.display = 'none';
      updateRecordStatus();
    });
  </script>
</body>
</html>
